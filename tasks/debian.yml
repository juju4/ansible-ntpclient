---

- name: apt | openntpd install
  ansible.builtin.apt: name=openntpd state=present
  register: pkg_result
  until: pkg_result is success

- name: configure openntpd default
  ansible.builtin.replace:
    dest: /etc/default/openntpd
    regexp: '^DAEMON_OPTS="(.*)"'
    replace: 'DAEMON_OPTS="-f /etc/openntpd/ntpd.conf {{ ntpclient_openntpd_opts }}"'
    mode: '0644'
    backup: yes
  notify:
    - restart openntpd

- name: configure openntpd
  ansible.builtin.template:
    src: ntpd.conf
    dest: /etc/openntpd/ntpd.conf
    mode: '0644'
    backup: yes
    # validate: 'openntpd -f %s -n'
  notify:
    - restart openntpd
